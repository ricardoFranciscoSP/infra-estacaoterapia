FROM alpine:3.20

# Instalar PgBouncer e dependências
RUN apk add --no-cache \
    pgbouncer \
    postgresql-client \
    netcat-openbsd \
    curl \
    ca-certificates \
    bash

# Criar diretório de configuração
RUN mkdir -p /etc/pgbouncer && \
    chmod 755 /etc/pgbouncer

# Health check
HEALTHCHECK --interval=10s --timeout=5s --retries=3 \
    CMD nc -z localhost 6432 || exit 1

EXPOSE 6432

ENTRYPOINT ["pgbouncer"]
CMD ["/etc/pgbouncer/pgbouncer.ini"]
